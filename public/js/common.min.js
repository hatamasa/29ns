(()=>{function t(n,t){t.find("i.fa-star").removeClass("fas");t.find("i.fa-star").addClass("far");$.ajax({url:"/user_like_shops/"+t.find(".shop-like").data("shop_cd"),type:"POST",data:{_method:"DELETE"}}).done(()=>{}).fail(n=>{if(t.find("i.fa-star").removeClass("far"),t.find("i.fa-star").addClass("fas"),n.responseJSON.verified){location.href="/email/verify";return}alert("予期せぬエラーが発生しました。")}).always(()=>{$(n.target).parents("a").removeClass("no-active")})}function i(n,t){t.find("i.fa-star").removeClass("far");t.find("i.fa-star").addClass("fas");$.ajax({url:"/user_like_shops",type:"POST",data:{shop_cd:t.find(".shop-like").data("shop_cd")}}).done(()=>{}).fail(n=>{if(t.find("i.fa-star").removeClass("fas"),t.find("i.fa-star").addClass("far"),n.responseJSON.verified){location.href="/email/verify";return}alert("予期せぬエラーが発生しました。")}).always(()=>{$(n.target).parents("a").removeClass("no-active")})}function r(n){let t=$(n.target).parents(".post-detail-link").find("a").get(0);$.ajax({url:"/post_like_users/"+t.dataset.post_id,type:"POST",data:{post_id:n.target.dataset.post_id,_method:"DELETE"}}).done(i=>{if(!i.return_code){alert(i.message);return}let r=location.protocol+"//"+location.host;$(n.target).parents(".card-body-footer").find(".like-disp").html('<img class="like-icon" src="'+r+'/images/like_black.png">'+i.like_count);t.classList.remove("liked");t.innerHTML='<img class="like-icon like" src="'+r+'/images/like.png">'}).fail(()=>{alert("予期せぬエラーが発生しました。")})}function u(n){let t=$(n.target).parents(".post-detail-link").find("a").get(0);$.ajax({url:"/post_like_users",type:"POST",data:{post_id:t.dataset.post_id}}).done(i=>{if(!i.return_code){alert(i.message);return}let r=location.protocol+"//"+location.host;$(n.target).parents(".card-body-footer").find(".like-disp").html('<img class="like-icon" src="'+r+'/images/like_black.png">'+i.like_count);t.classList.add("liked");t.innerHTML='<img class="like-icon liked" src="'+r+'/images/like.png">済'}).fail(()=>{alert("予期せぬエラーが発生しました。")})}function f(n){let t=$(n.target).parents(".follow-icon").find(".follow-link");t.parent().removeClass("followed-li");t.parent().addClass("follow-li");t.html('フォロー<div><span class="follow"><\/span><\/div>');$.ajax({url:"/user_follows/"+t.data("user_id"),type:"POST",data:{_method:"DELETE"}}).done(n=>{if(!n.return_code){alert(n.message);return}}).fail(()=>{alert("予期せぬエラーが発生しました。")})}function e(n){let t=$(n.target).parents(".follow-icon").find(".follow-link");t.parent().removeClass("follow-li");t.parent().addClass("followed-li");t.html('フォロー中<div><span class="followed"><\/span><\/div>');$.ajax({url:"/user_follows",type:"POST",data:{follow_user_id:+t.data("user_id")}}).done(n=>{if(!n.return_code){alert(n.message);return}}).fail(()=>{alert("予期せぬエラーが発生しました。")})}document.addEventListener("DOMContentLoaded",function(){$(".adsbygoogle").each(function(){(adsbygoogle=window.adsbygoogle||[]).push({})})});$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});const n=document.getElementsByClassName("flash");n&&[].forEach.call(n,n=>{$(n).fadeOut(4e3)});[].forEach.call(document.getElementsByClassName("posted-wrap"),n=>{n.classList.contains("posted")?n.addEventListener("click",n=>{n.preventDefault(),alert("すでに投稿しています。")}):n.addEventListener("click",n=>{n.preventDefault(),$(n.target).parents("a").addClass("no-active"),location.href=$(n.target).parents(".card-head").find(".posted-wrap").data("link")})});[].forEach.call(document.getElementsByClassName("shop-like"),n=>{n.addEventListener("click",n=>{n.preventDefault();$(n.target).parents("a").addClass("no-active");let r=$(n.target).parents(".card-head");r.find("i.fa-star").hasClass("fas")?t(n,r):i(n,r)})});document.addEventListener("click",n=>{switch(!0){case n.target.classList.contains("liked"):r(n);break;case n.target.classList.contains("like"):u(n)}});[].forEach.call(document.getElementsByClassName("follow-link"),n=>{n.addEventListener("click",n=>{let t=$(n.target).parents(".follow-icon").find("span").get(0);t.classList.contains("followed")?f(n):e(n)})})})()